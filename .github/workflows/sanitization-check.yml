name: Sanitization Check

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  check-sanitization:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Check for forbidden terms
      run: |
        echo "Checking for forbidden terms..."
        
        # Check file contents for forbidden terms
        if grep -r -i "lovable\|ai builder\|generated by" --exclude-dir=.git --exclude="*.yml" --exclude="*.yaml" .; then
          echo "❌ Found forbidden terms in file contents"
          exit 1
        fi
        
        # Check file names for forbidden terms
        if find . -name "*lovable*" -o -name "*ai-builder*" | grep -v ".git"; then
          echo "❌ Found forbidden terms in file names"
          exit 1
        fi
        
        # Check commit messages
        if git log --oneline -10 | grep -i "lovable\|ai builder\|generated by"; then
          echo "❌ Found forbidden terms in commit messages"
          exit 1
        fi
        
        echo "✅ No forbidden terms found"
    
    - name: Check README for vendor attribution
      run: |
        if grep -i "lovable\|ai builder\|generated by" README.md; then
          echo "❌ README contains vendor attribution"
          exit 1
        fi
        echo "✅ README is clean"
    
    - name: Check package.json for forbidden dependencies
      run: |
        if grep -i "lovable" package.json; then
          echo "❌ package.json contains forbidden dependencies"
          exit 1
        fi
        echo "✅ package.json is clean"
